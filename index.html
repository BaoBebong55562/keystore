<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KeyStore Pro - Digital Products Marketplace</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    * {
      box-sizing: border-box;
    }

    @keyframes slideIn {
      from {
        transform: translateX(100%);
      }
      to {
        transform: translateX(0);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes float {
      0%, 100% {
        transform: translateY(0px);
      }
      50% {
        transform: translateY(-10px);
      }
    }

    @keyframes successCheckmark {
      0% {
        transform: scale(0) rotate(45deg) translateY(-5px);
        opacity: 0;
      }
      50% {
        transform: scale(1.2) rotate(45deg) translateY(-5px);
      }
      100% {
        transform: scale(1) rotate(45deg) translateY(-5px);
        opacity: 1;
      }
    }

    @keyframes ripple {
      0% {
        transform: scale(0);
        opacity: 1;
      }
      100% {
        transform: scale(4);
        opacity: 0;
      }
    }

    @keyframes checkmark {
      0% {
        stroke-dashoffset: 50;
      }
      100% {
        stroke-dashoffset: 0;
      }
    }

    @keyframes snowfall {
      0% {
        transform: translateY(-10px) translateX(0) rotate(0deg);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      90% {
        opacity: 1;
      }
      100% {
        transform: translateY(100vh) translateX(50px) rotate(360deg);
        opacity: 0;
      }
    }

    .snowflake {
      position: fixed;
      top: -10px;
      color: #ffffff;
      font-size: 1em;
      pointer-events: none;
      z-index: 9998;
      animation: snowfall linear infinite;
      text-shadow: 0 0 5px rgba(255, 255, 255, 0.8);
      will-change: transform, opacity;
    }

    .cart-drawer {
      animation: slideIn 0.3s ease-out;
    }

    .toast {
      animation: fadeIn 0.3s ease-out;
    }

    .product-card {
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }

    .product-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    }

    .badge {
      font-size: 0.75rem;
      padding: 0.25rem 0.5rem;
      border-radius: 0.25rem;
      font-weight: 600;
    }

    .cart-item {
      position: relative;
    }

    .cart-item .delete-button {
      opacity: 0;
      transition: opacity 0.2s;
    }

    .cart-item:hover .delete-button {
      opacity: 1;
    }

    .payment-option {
      transition: all 0.3s;
      cursor: pointer;
    }

    .payment-option:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .payment-option.selected {
      border-width: 2px;
    }

    .chat-button {
      animation: float 3s ease-in-out infinite;
      transition: all 0.3s ease;
    }

    .chat-button:hover {
      animation: none;
      transform: scale(1.2) rotate(10deg);
      box-shadow: 0 10px 30px rgba(0, 102, 204, 0.4);
    }

    .chat-button:active {
      transform: scale(1.1) rotate(5deg);
    }

    .carousel-container {
      position: relative;
      overflow: hidden;
    }

    .carousel-track {
      display: flex;
      transition: transform 0.5s ease-in-out;
    }

    .success-checkmark {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 20px;
      position: relative;
    }

    .checkmark {
      width: 25px;
      height: 45px;
      border-right: 6px solid #fff;
      border-bottom: 6px solid #fff;
      transform: rotate(45deg) translateY(-5px);
      animation: successCheckmark 0.5s ease-out forwards;
    }

    .input-error {
      border-color: #ef4444 !important;
    }

    .error-message {
      color: #ef4444;
      font-size: 0.75rem;
      margin-top: 0.25rem;
    }

    .toast-success {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 9999;
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 24px 36px;
      border-radius: 20px;
      box-shadow: 0 25px 70px rgba(0, 0, 0, 0.4);
      animation: fadeIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      min-width: 320px;
      justify-content: center;
      backdrop-filter: blur(10px);
    }

    .checkmark-icon {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      background-color: #22c55e !important;
      animation: scaleIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    .checkmark-svg {
      stroke-dasharray: 50;
      stroke-dashoffset: 50;
      animation: checkmark 0.6s ease-out 0.2s forwards;
    }

    @keyframes scaleIn {
      0% {
        transform: scale(0) rotate(-180deg);
        opacity: 0;
      }
      50% {
        transform: scale(1.1) rotate(10deg);
      }
      100% {
        transform: scale(1) rotate(0deg);
        opacity: 1;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full overflow-auto">
  <div id="app" class="min-h-full w-full"></div>
  <script>
    // Translations
    const translations = {
      vi: {
        siteTitle: 'KeyStore Pro',
        search: 'T√¨m ki·∫øm s·∫£n ph·∫©m...',
        cart: 'Gi·ªè h√†ng',
        heroTitle: 'Ph·∫ßn m·ªÅm B·∫£n quy·ªÅn Gi√° T·ªët Nh·∫•t',
        heroSubtitle: 'Ti·∫øt ki·ªám ƒë·∫øn 50% - Giao h√†ng ngay',
        shopNow: 'Mua ngay',
        categories: 'Danh m·ª•c',
        allProducts: 'T·∫•t c·∫£ s·∫£n ph·∫©m',
        addToCart: 'Th√™m v√†o gi·ªè',
        yourCart: 'Gi·ªè h√†ng c·ªßa b·∫°n',
        emptyCart: 'Gi·ªè h√†ng tr·ªëng',
        startShopping: 'BÔøΩÔøΩÔøΩÔøΩt ƒë·∫ßu mua s·∫Øm',
        continueShopping: 'Ti·∫øp t·ª•c mua s·∫Øm',
        checkout: 'Thanh to√°n',
        subtotal: 'T·∫°m t√≠nh',
        shipping: 'Ph√≠ v·∫≠n chuy·ªÉn',
        free: 'Mi·ªÖn ph√≠',
        total: 'T·ªïng c·ªông',
        remove: 'X√≥a',
        quantity: 'SL',
        selectOption: 'Ch·ªçn t√πy ch·ªçn',
        addedToCart: 'ƒê√£ th√™m v√†o gi·ªè h√†ng!',
        support: 'H·ªó tr·ª£',
        checkoutTitle: 'Thanh to√°n',
        customerInfo: 'Th√¥ng tin kh√°ch h√†ng',
        name: 'H·ªç v√† t√™n',
        email: 'Email',
        phone: 'S·ªë ƒëi·ªán tho·∫°i',
        paymentMethod: 'Ph∆∞∆°ng th·ª©c thanh to√°n',
        bankTransfer: 'Chuy·ªÉn kho·∫£n',
        bankDesc: 'Thanh to√°n qua QR Code',
        momo: 'V√≠ Momo',
        momoDesc: 'Thanh to√°n v√≠ ƒëi·ªán t·ª≠',
        orderSummary: 'Th√¥ng tin ƒë∆°n h√†ng',
        placeOrder: 'ƒê·∫∑t h√†ng',
        orderSuccess: 'ƒê·∫∑t h√†ng th√†nh c√¥ng!',
        orderSuccessDesc: 'Vui l√≤ng chuyÔøΩÔøΩn kho·∫£n vÔøΩÔøΩ g·ª≠i bill qua Telegram',
        backToCart: 'Quay l·∫°i gi·ªè h√†ng',
        backToHome: 'V·ªÅ trang ch·ªß',
        secureCheckout: 'üîí Thanh to√°n b·∫£o m·∫≠t',
        cheaperThan: 'R·∫ª h∆°n gi√° g·ªëc',
        featuredProducts: 'S·∫£n ph·∫©m n·ªïi b·∫≠t',
        aboutTitle: 'T·∫°i sao ch·ªçn ch√∫ng t√¥i?',
        aboutDesc: 'Ch√∫ng t√¥i cung c·∫•p ph·∫ßn m·ªÅm b·∫£n quy·ªÅn ch√≠nh h√£ng v·ªõi gi√° t·ªët nh·∫•t v√† giao h√†ng ngay l·∫≠p t·ª©c',
        warranty: 'Ch√≠nh s√°ch b·∫£o h√†nh',
        terms: 'ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng',
        contact: 'Li√™n h·ªá',
        sendProofToTelegram: 'GÔøΩÔøΩi bill chuy·ªÉn kho·∫£n qua Telegram',
        invalidName: 'Vui l√≤ng nh·∫≠p h·ªç t√™n h·ª£p l·ªá (√≠t nh·∫•t 2 k√Ω t·ª±)',
        invalidEmail: 'Vui l√≤ng nh·∫≠p ƒë·ªãa ch·ªâ email h·ª£p l·ªá',
        invalidPhone: 'Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i h·ª£p l·ªá (10 ch·ªØ s·ªë)',
        contactNow: 'Li√™n h·ªá ngay',
        pleaseContact: 'Vui l√≤ng li√™n h·ªá',
        categories_nav: {
          'maps': 'B·∫£n ƒë·ªì & D·∫´n ƒë∆∞·ªùng',
          'ai': 'AI & Chatbot',
          'design': 'Thi·∫øt k·∫ø & ƒê·ªì h·ªça',
          'tools': 'C√¥ng c·ª• & L∆∞u tr·ªØ'
        },
        authenticLicense: 'B·∫£n quy·ªÅn ch√≠nh h√£ng',
        authenticDesc: '100% h·ª£p ph√°p',
        bestWarranty: 'B·∫£o h√†nh t·ªët nh·∫•t',
        warrantyDesc: 'H·ªó tr·ª£ 24/7'
      },
      en: {
        siteTitle: 'KeyStore Pro',
        search: 'Search products...',
        cart: 'Cart',
        heroTitle: 'Best Licensed Software Prices',
        heroSubtitle: 'Save up to 50% - Instant Delivery',
        shopNow: 'Shop Now',
        categories: 'Categories',
        allProducts: 'All Products',
        addToCart: 'Add to Cart',
        yourCart: 'Your Cart',
        emptyCart: 'Cart is empty',
        startShopping: 'Start shopping',
        continueShopping: 'Continue Shopping',
        checkout: 'Checkout',
        subtotal: 'Subtotal',
        shipping: 'Shipping',
        free: 'Free',
        total: 'Total',
        remove: 'Remove',
        quantity: 'Qty',
        selectOption: 'Select option',
        addedToCart: 'Added to cart!',
        support: 'Support',
        checkoutTitle: 'Checkout',
        customerInfo: 'Customer Information',
        name: 'Full Name',
        email: 'Email',
        phone: 'Phone Number',
        paymentMethod: 'Payment Method',
        bankTransfer: 'Bank Transfer',
        bankDesc: 'Pay via QR Code',
        momo: 'Momo Wallet',
        momoDesc: 'E-wallet payment',
        orderSummary: 'Order Summary',
        placeOrder: 'Place Order',
        orderSuccess: 'Order Successful!',
        orderSuccessDesc: 'Please transfer payment and send receipt via Telegram',
        backToCart: 'Back to Cart',
        backToHome: 'Back to Home',
        secureCheckout: 'üîí Secure Checkout',
        cheaperThan: 'Cheaper than original',
        featuredProducts: 'Featured Products',
        aboutTitle: 'Why Choose Us?',
        aboutDesc: 'We provide genuine licensed software at the best prices with instant delivery',
        warranty: 'Warranty Policy',
        terms: 'Terms of Service',
        contact: 'Contact',
        sendProofToTelegram: 'Send payment proof via Telegram',
        invalidName: 'Please enter a valid name (at least 2 characters)',
        invalidEmail: 'Please enter a valid email address',
        invalidPhone: 'Please enter a valid phone number (10 digits)',
        contactNow: 'Contact Now',
        pleaseContact: 'Please Contact',
        categories_nav: {
          'maps': 'Maps & Navigation',
          'ai': 'AI & Chatbot',
          'design': 'Design & Graphics',
          'tools': 'Tools & Storage'
        },
        authenticLicense: 'Authentic License',
        authenticDesc: '100% Legal',
        bestWarranty: 'Best Warranty',
        warrantyDesc: '24/7 Support'
      }
    };

    const productsData = [
      {
        id: 1,
        category: 'maps',
        name: 'Vietmap Live',
        description: 'D·ªãch v·ª• d·∫´n ƒë∆∞·ªùng cao c·∫•p',
        image: 'üó∫Ô∏è',
        badge: 'B√°n ch·∫°y',
        featured: true,
        hasVariations: true,
        variations: [
          { id: '1h', name: '1 gi·ªù', originalPrice: 50000, price: 35000 },
          { id: '3d', name: '3 ng√†y', originalPrice: 150000, price: 99000 },
          { id: '1y', name: '1 nƒÉm', originalPrice: 400000, price: 299000 },
          { id: '2y', name: '2 nƒÉm', originalPrice: 650000, price: 499000 }
        ]
      },
      {
        id: 2,
        category: 'ai',
        name: 'ChatGPT Plus',
        description: 'Tr·ª£ l√Ω AI cao c·∫•p',
        image: 'ü§ñ',
        badge: 'Gi·∫£m gi√°',
        featured: true,
        originalPrice: 350000,
        price: 250000
      },
      {
        id: 3,
        category: 'ai',
        name: 'ChatGPT Business',
        description: 'D√†nh cho doanh nghi·ªáp',
        image: 'üíº',
        badge: 'Doanh nghi·ªáp',
        featured: true,
        originalPrice: 450000,
        price: 300000
      },
      {
        id: 4,
        category: 'design',
        name: 'Canva Pro',
        description: 'C√¥ng c·ª• thi·∫øt k·∫ø chuy√™n nghi·ªáp',
        image: 'üé®',
        badge: 'Ph·ªï bi·∫øn',
        featured: true,
        originalPrice: 350000,
        price: 250000
      },
      {
        id: 5,
        category: 'tools',
        name: 'Google Drive Unlimited',
        description: 'L∆∞u tr·ªØ ƒë√°m m√¢y kh√¥ng gi·ªõi h·∫°n',
        image: '‚òÅÔ∏è',
        badge: 'Gi√° t·ªët nh·∫•t',
        featured: false,
        originalPrice: 300000,
        price: 200000
      },
      {
        id: 6,
        category: 'tools',
        name: 'Microsoft 365',
        description: 'B·ªô c√¥ng c·ª• vƒÉn ph√≤ng',
        image: 'üìä',
        badge: 'Cao c·∫•p',
        featured: true,
        originalPrice: 400000,
        price: 280000
      },
      {
        id: 7,
        category: 'tools',
        name: 'R√∫t vÔøΩÔøΩ tr·∫£ sau Momo',
        description: 'R√∫t ti·ªÅn t·ª´ v√≠ tr·∫£ sau Momo',
        image: 'üí∞',
        badge: 'Li√™n h·ªá',
        featured: true,
        hasVariations: false,
        contactOnly: true
      }
    ];

    // Default configuration
    const defaultConfig = {
      background_color: '#ffffff',
      surface_color: '#f8f9fa',
      text_color: '#1a1a1a',
      primary_action_color: '#0066cc',
      secondary_action_color: '#6c757d',
      font_family: 'system-ui',
      font_size: 16,
      site_title: 'KeyStore Pro',
      hero_title: 'Ph·∫ßn m·ªÅm B·∫£n quy·ªÅn Gi√° T·ªët Nh·∫•t',
      hero_subtitle: 'Ti·∫øt ki·ªám ƒë·∫øn 50%',
      about_title: 'T·∫°i sao ch·ªçn ch√∫ng t√¥i?',
      about_description: 'Ch√∫ng t√¥i cung c·∫•p ph·∫ßn m·ªÅm b·∫£n quy·ªÅn ch√≠nh h√£ng v·ªõi gi√° t·ªët nh·∫•t',
      search_placeholder: 'T√¨m ki·∫øm s·∫£n ph·∫©m...',
      add_to_cart_text: 'Th√™m v√†o gi·ªè',
      checkout_button: 'Thanh to√°n',
      telegram_link: 'https://t.me/yourusername'
    };

    // Application state
    let cart = [];
    let isCartOpen = false;
    let isCheckoutOpen = false;
    let showOrderSuccess = false;
    let currentLanguage = 'vi';
    let selectedCategory = 'all';
    let selectedPaymentMethod = 'bank';
    let currentPage = 'home';
    let carouselIndex = 0;
    let carouselInterval = null;
    let formErrors = {};
    let snowflakes = [];
    let discountCode = '';
    let discountApplied = false;
    let showPolicyModal = false;
    let policyType = 'terms';

    const validDiscountCodes = ['OAWNSZ-451', 'JAUSDH-7805'];

    function t(key) {
      const keys = key.split('.');
      let value = translations[currentLanguage];
      for (const k of keys) {
        value = value[k];
        if (!value) return key;
      }
      return value || key;
    }

    function formatPrice(price) {
      return new Intl.NumberFormat('vi-VN').format(price) + 'ƒë';
    }

    function addToCart(product, variation = null) {
      const cartItem = {
        id: variation ? `${product.id}-${variation.id}` : `${product.id}`,
        productId: product.id,
        name: product.name,
        price: variation ? variation.price : product.price,
        variation: variation ? variation.name : null,
        quantity: 1,
        image: product.image
      };

      const existingIndex = cart.findIndex(item => item.id === cartItem.id);
      if (existingIndex !== -1) {
        cart[existingIndex].quantity += 1;
      } else {
        cart.push(cartItem);
      }

      showToast(t('addedToCart'));
      render();
    }

    function removeFromCart(itemId) {
      cart = cart.filter(item => item.id !== itemId);
      render();
    }

    function updateQuantity(itemId, newQuantity) {
      if (newQuantity < 1) return;
      const item = cart.find(item => item.id === itemId);
      if (item) {
        item.quantity = newQuantity;
        render();
      }
    }

    function getCartTotal() {
      return cart.reduce((total, item) => {
        return total + (item.price * item.quantity);
      }, 0);
    }

    function getDiscountAmount() {
      if (discountApplied) {
        return Math.round(getCartTotal() * 0.1); // 10% discount
      }
      return 0;
    }

    function getFinalTotal() {
      const total = getCartTotal();
      const discount = getDiscountAmount();
      return total - discount;
    }

    function applyDiscountCode() {
      const input = document.getElementById('discount-code-input');
      if (!input) return;
      
      const code = input.value.trim().toUpperCase();
      
      if (validDiscountCodes.includes(code)) {
        discountCode = code;
        discountApplied = true;
        showToast('M√£ gi·∫£m gi√° ƒë√£ ƒë∆∞·ª£c √°p d·ª•ng! Gi·∫£m 10%');
        render();
      } else {
        showToast('M√£ gi·∫£m gi√° kh√¥ng h·ª£p l·ªá');
        input.classList.add('input-error');
        setTimeout(() => {
          input.classList.remove('input-error');
        }, 2000);
      }
    }

    function removeDiscountCode() {
      discountCode = '';
      discountApplied = false;
      render();
    }

    function showPolicy(type) {
      policyType = type;
      showPolicyModal = true;
      render();
    }

    function closePolicy() {
      showPolicyModal = false;
      render();
    }

    function toggleLanguage() {
      currentLanguage = currentLanguage === 'vi' ? 'en' : 'vi';
      render();
    }

    function createSnowflakes() {
      const snowflakeContainer = document.getElementById('snowflakes');
      if (!snowflakeContainer) return;
      
      snowflakeContainer.innerHTML = '';
      
      for (let i = 0; i < 50; i++) {
        const snowflake = document.createElement('div');
        snowflake.className = 'snowflake';
        snowflake.textContent = '‚ùÑ';
        snowflake.style.left = Math.random() * 100 + '%';
        snowflake.style.animationDuration = (Math.random() * 3 + 2) + 's';
        snowflake.style.animationDelay = Math.random() * 5 + 's';
        snowflake.style.fontSize = (Math.random() * 10 + 10) + 'px';
        snowflake.style.opacity = Math.random() * 0.6 + 0.4;
        snowflakeContainer.appendChild(snowflake);
      }
    }

    function showToast(message) {
      const config = window.elementSdk?.config || defaultConfig;
      const toast = document.createElement('div');
      toast.className = 'toast-success';
      toast.style.backgroundColor = 'rgba(255, 255, 255, 0.98)';
      toast.style.color = config.text_color;
      toast.style.border = `3px solid ${config.primary_action_color}`;
      
      toast.innerHTML = `
        <div class="checkmark-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path class="checkmark-svg" d="M5 12L10 17L20 7" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <span style="font-weight: 700; font-size: ${config.font_size * 1.125}px;">${message}</span>
      `;
      
      document.body.appendChild(toast);

      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translate(-50%, -50%) scale(0.8)';
        toast.style.transition = 'all 0.3s ease-out';
        setTimeout(() => {
          toast.remove();
        }, 300);
      }, 2500);
    }

    function toggleCart() {
      isCartOpen = !isCartOpen;
      if (isCartOpen) {
        isCheckoutOpen = false;
        showOrderSuccess = false;
      }
      render();
    }

    function filterByCategory(category) {
      selectedCategory = category;
      render();
    }

    function navigateTo(page) {
      currentPage = page;
      isCartOpen = false;
      isCheckoutOpen = false;
      showOrderSuccess = false;
      window.scrollTo(0, 0);
      render();
    }

    function proceedToCheckout() {
      if (cart.length === 0) return;
      isCheckoutOpen = true;
      isCartOpen = false;
      currentPage = 'home';
      render();
    }

    function backToCart() {
      isCheckoutOpen = false;
      isCartOpen = true;
      showOrderSuccess = false;
      render();
    }

    function backToHome() {
      isCheckoutOpen = false;
      isCartOpen = false;
      showOrderSuccess = false;
      currentPage = 'home';
      render();
    }

    function selectPaymentMethod(method) {
      selectedPaymentMethod = method;
      render();
    }

    function validateName(name) {
      return name.trim().length >= 2;
    }

    function validateEmail(email) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    }

    function validatePhone(phone) {
      const phoneRegex = /^(0|\+84)(3|5|7|8|9)[0-9]{8}$/;
      return phoneRegex.test(phone.replace(/\s/g, ''));
    }

    function placeOrder(event) {
      if (event) event.preventDefault();
      
      const form = document.getElementById('checkout-form');
      if (!form) return;
      
      const nameInput = form.querySelector('input[name="name"]');
      const emailInput = form.querySelector('input[name="email"]');
      const phoneInput = form.querySelector('input[name="phone"]');

      formErrors = {};

      if (!validateName(nameInput.value)) {
        formErrors.name = t('invalidName');
      }

      if (!validateEmail(emailInput.value)) {
        formErrors.email = t('invalidEmail');
      }

      if (!validatePhone(phoneInput.value)) {
        formErrors.phone = t('invalidPhone');
      }

      if (Object.keys(formErrors).length > 0) {
        render();
        return;
      }

      showOrderSuccess = true;
      render();
    }

    function startCarousel() {
      if (carouselInterval) clearInterval(carouselInterval);
      carouselInterval = setInterval(() => {
        nextSlide();
      }, 4000);
    }

    function stopCarousel() {
      if (carouselInterval) {
        clearInterval(carouselInterval);
        carouselInterval = null;
      }
    }

    function nextSlide() {
      const featured = productsData.filter(p => p.featured);
      carouselIndex = (carouselIndex + 1) % featured.length;
      updateCarousel();
    }

    function prevSlide() {
      const featured = productsData.filter(p => p.featured);
      carouselIndex = (carouselIndex - 1 + featured.length) % featured.length;
      updateCarousel();
    }

    function updateCarousel() {
      const track = document.querySelector('.carousel-track');
      if (track) {
        track.style.transform = `translateX(-${carouselIndex * 100}%)`;
      }
    }

    function ProductCard(product, isCarousel = false) {
      const config = window.elementSdk?.config || defaultConfig;
      const hasVariations = product.hasVariations;
      const contactOnly = product.contactOnly;
      
      return `
        <div class="product-card rounded-xl overflow-hidden shadow-lg ${isCarousel ? 'w-full flex-shrink-0' : ''}" style="background-color: ${config.surface_color}; border: 2px solid ${config.primary_action_color};">
          <div class="p-6">
            <div class="text-6xl text-center mb-4">${product.image}</div>
            <div class="mb-2">
              <span class="badge" style="background-color: ${config.primary_action_color}; color: ${config.background_color};">
                ${product.badge}
              </span>
            </div>
            <h3 class="font-bold mb-2" style="color: ${config.primary_action_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 1.125}px;">
              ${product.name}
            </h3>
            <p class="mb-4" style="color: ${config.text_color}; opacity: 0.8; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 0.875}px;">
              ${product.description}
            </p>
            
            ${contactOnly ? `
              <div class="mb-3 text-center">
                <span class="font-bold" style="color: ${config.primary_action_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 1.25}px;">
                  ${t('pleaseContact')}
                </span>
              </div>
              <a 
                href="${config.telegram_link || defaultConfig.telegram_link}" 
                target="_blank"
                rel="noopener noreferrer"
                class="block w-full py-3 rounded-lg font-semibold transition-all hover:opacity-90 text-center"
                style="background-color: ${config.primary_action_color}; color: ${config.background_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size}px; text-decoration: none;"
              >
                üì± ${t('contactNow')}
              </a>
            ` : hasVariations ? `
              <select 
                data-product-id="${product.id}" 
                class="w-full mb-3 px-3 py-2 border-2 rounded-lg"
                style="background-color: ${config.background_color}; color: ${config.text_color}; border-color: ${config.secondary_action_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size}px;"
              >
                <option value="">${t('selectOption')}</option>
                ${product.variations.map(v => `
                  <option value="${v.id}">
                    ${v.name} - ${formatPrice(v.price)}
                  </option>
                `).join('')}
              </select>
              <button 
                onclick="handleAddToCart(${product.id})"
                class="w-full py-3 rounded-lg font-semibold transition-all hover:opacity-90"
                style="background-color: ${config.primary_action_color}; color: ${config.background_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size}px;"
              >
                ${config.add_to_cart_text || t('addToCart')}
              </button>
            ` : `
              <div class="mb-3">
                <div class="flex items-center gap-2">
                  <span class="line-through" style="color: ${config.secondary_action_color}; opacity: 0.6; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 0.875}px;">
                    ${formatPrice(product.originalPrice)}
                  </span>
                  <span class="font-bold" style="color: ${config.primary_action_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 1.5}px;">
                    ${formatPrice(product.price)}
                  </span>
                </div>
              </div>
              <button 
                onclick="handleAddToCart(${product.id})"
                class="w-full py-3 rounded-lg font-semibold transition-all hover:opacity-90"
                style="background-color: ${config.primary_action_color}; color: ${config.background_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size}px;"
              >
                ${config.add_to_cart_text || t('addToCart')}
              </button>
            `}
          </div>
        </div>
      `;
    }

    function CartDrawer() {
      if (!isCartOpen) return '';
      
      const config = window.elementSdk?.config || defaultConfig;
      const subtotal = getCartTotal();
      const shipping = 0;
      const discount = getDiscountAmount();
      const total = getFinalTotal();

      return `
        <div class="fixed inset-0 z-50" style="background-color: rgba(0, 0, 0, 0.8);" onclick="toggleCart()">
          <div class="cart-drawer fixed right-0 top-0 h-full w-full max-w-md shadow-2xl flex flex-col" 
               style="background-color: ${config.surface_color}; border-left: 2px solid ${config.primary_action_color};"
               onclick="event.stopPropagation()">
            
            <div class="p-6 border-b" style="border-color: ${config.primary_action_color};">
              <div class="flex items-center justify-between">
                <h2 class="font-bold" style="color: ${config.primary_action_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 1.5}px;">
                  ${t('yourCart')} (${cart.length})
                </h2>
                <button onclick="toggleCart()" class="p-2 hover:opacity-70" style="color: ${config.text_color};">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                  </svg>
                </button>
              </div>
            </div>
            
            <div class="flex-1 overflow-auto p-6">
              ${cart.length === 0 ? `
                <div class="flex flex-col items-center justify-center h-full text-center py-12">
                  <svg class="w-24 h-24 mb-4" style="color: ${config.primary_action_color};" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
                  </svg>
                  <p class="text-lg mb-2" style="color: ${config.primary_action_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 1.125}px;">
                    ${t('emptyCart')}
                  </p>
                  <p class="mb-6" style="color: ${config.text_color}; opacity: 0.8; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 0.875}px;">
                    ${t('startShopping')}
                  </p>
                  <button 
                    onclick="toggleCart()"
                    class="px-6 py-3 rounded-lg font-semibold hover:opacity-90 transition-all"
                    style="background-color: ${config.primary_action_color}; color: ${config.background_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size}px;"
                  >
                    ${t('continueShopping')}
                  </button>
                </div>
              ` : `
                <div class="space-y-4">
                  ${cart.map(item => `
                    <div class="cart-item flex gap-4 p-4 rounded-xl relative" style="background-color: ${config.background_color}; border: 2px solid ${config.secondary_action_color};">
                      <div class="text-4xl flex-shrink-0">${item.image}</div>
                      <div class="flex-1 min-w-0">
                        <h4 class="font-semibold mb-1 truncate" style="color: ${config.text_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size}px;">
                          ${item.name}
                        </h4>
                        ${item.variation ? `
                          <p class="text-sm mb-2" style="color: ${config.text_color}; opacity: 0.7; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 0.875}px;">
                            ${item.variation}
                          </p>
                        ` : ''}
                        <div class="flex items-center justify-between gap-3">
                          <div class="flex items-center gap-2">
                            <button 
                              onclick="updateQuantity('${item.id}', ${item.quantity - 1})"
                              class="w-8 h-8 rounded-lg flex items-center justify-center font-bold transition-all hover:opacity-90"
                              style="background-color: ${config.secondary_action_color}; color: ${config.text_color};"
                            >‚àí</button>
                            <span class="w-8 text-center font-semibold" style="color: ${config.text_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size}px;">
                              ${item.quantity}
                            </span>
                            <button 
                              onclick="updateQuantity('${item.id}', ${item.quantity + 1})"
                              class="w-8 h-8 rounded-lg flex items-center justify-center font-bold transition-all hover:opacity-90"
                              style="background-color: ${config.primary_action_color}; color: ${config.background_color};"
                            >+</button>
                          </div>
                          <div class="text-right">
                            <div class="font-bold" style="color: ${config.primary_action_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 1.125}px;">
                              ${formatPrice(item.price * item.quantity)}
                            </div>
                          </div>
                        </div>
                      </div>
                      <button 
                        onclick="removeFromCart('${item.id}')"
                        class="delete-button absolute top-2 right-2 w-6 h-6 rounded-full flex items-center justify-center transition-all hover:opacity-90"
                        style="background-color: #ef4444; color: #ffffff;"
                      >
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                      </button>
                    </div>
                  `).join('')}
                </div>
              `}
            </div>
            
            ${cart.length > 0 ? `
              <div class="border-t p-6 space-y-4" style="border-color: ${config.primary_action_color};">
                <div class="space-y-2">
                  <div class="flex justify-between">
                    <span style="color: ${config.text_color}; opacity: 0.8; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 0.875}px;">
                      ${t('subtotal')}:
                    </span>
                    <span class="font-semibold" style="color: ${config.text_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 0.875}px;">
                      ${formatPrice(subtotal)}
                    </span>
                  </div>
                  ${discountApplied ? `
                    <div class="flex justify-between">
                      <span style="color: ${config.text_color}; opacity: 0.8; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 0.875}px;">
                        Gi·∫£m gi√° (10%):
                      </span>
                      <span class="font-semibold" style="color: #22c55e; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 0.875}px;">
                        -${formatPrice(discount)}
                      </span>
                    </div>
                  ` : ''}
                  <div class="flex justify-between">
                    <span style="color: ${config.text_color}; opacity: 0.8; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 0.875}px;">
                      ${t('shipping')}:
                    </span>
                    <span class="font-semibold" style="color: ${config.primary_action_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 0.875}px;">
                      ${t('free')}
                    </span>
                  </div>
                  <div class="border-t pt-2" style="border-color: ${config.secondary_action_color};">
                    <div class="flex justify-between items-center">
                      <span class="font-bold" style="color: ${config.text_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 1.125}px;">
                        ${t('total')}:
                      </span>
                      <span class="font-bold" style="color: ${config.primary_action_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 1.5}px;">
                        ${formatPrice(total)}
                      </span>
                    </div>
                  </div>
                </div>
                <button 
                  onclick="proceedToCheckout()"
                  class="w-full py-4 rounded-xl font-bold transition-all hover:opacity-90"
                  style="background-color: ${config.primary_action_color}; color: ${config.background_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size}px;"
                >
                  ${config.checkout_button || t('checkout')}
                </button>
              </div>
            ` : ''}
          </div>
        </div>
      `;
    }

    function PolicyModal() {
      if (!showPolicyModal) return '';
      
      const config = window.elementSdk?.config || defaultConfig;
      
      const policyContent = {
        terms: {
          title: 'ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng',
          content: `
            <div class="space-y-4">
              <h3 class="font-bold text-lg" style="color: ${config.primary_action_color};">1. Ch·∫•p nh·∫≠n ƒëi·ªÅu kho·∫£n</h3>
              <p style="color: ${config.text_color};">B·∫±ng vi·ªác s·ª≠ d·ª•ng d·ªãch v·ª• c·ªßa ch√∫ng t√¥i, b·∫°n ƒë·ªìng √Ω v·ªõi t·∫•t c·∫£ c√°c ƒëi·ªÅu kho·∫£n v√† ƒëi·ªÅu ki·ªán ƒë∆∞·ª£c n√™u trong t√†i li·ªáu n√†y.</p>
              
              <h3 class="font-bold text-lg" style="color: ${config.primary_action_color};">2. S·∫£n ph·∫©m v√† d·ªãch v·ª•</h3>
              <p style="color: ${config.text_color};">T·∫•t c·∫£ s·∫£n ph·∫©m ƒë∆∞·ª£c b√°n l√† b·∫£n quy·ªÅn ch√≠nh h√£ng. Ch√∫ng t√¥i cam k·∫øt cung c·∫•p key/license h·ª£p l·ªá v√† h·ªó tr·ª£ k√≠ch ho·∫°t.</p>
              
              <h3 class="font-bold text-lg" style="color: ${config.primary_action_color};">3. Thanh to√°n</h3>
              <p style="color: ${config.text_color};">Kh√°ch h√†ng c·∫ßn chuy·ªÉn kho·∫£n ƒë√∫ng s·ªë ti·ªÅn v√† g·ª≠i bill x√°c nh·∫≠n qua Telegram. ƒê∆°n h√†ng ƒë∆∞·ª£c x·ª≠ l√Ω trong v√≤ng 5-30 ph√∫t sau khi nh·∫≠n ƒë∆∞·ª£c x√°c nh·∫≠n thanh to√°n.</p>
              
              <h3 class="font-bold text-lg" style="color: ${config.primary_action_color};">4. Ch√≠nh s√°ch ho√†n ti·ªÅn</h3>
              <p style="color: ${config.text_color};">Ch√∫ng t√¥i kh√¥ng ho√†n ti·ªÅn sau khi ƒë√£ giao key/license, tr·ª´ tr∆∞·ªùng h·ª£p key kh√¥ng ho·∫°t ƒë·ªông v√† kh√¥ng th·ªÉ kh·∫Øc ph·ª•c.</p>
              
              <h3 class="font-bold text-lg" style="color: ${config.primary_action_color};">5. B·∫£o m·∫≠t th√¥ng tin</h3>
              <p style="color: ${config.text_color};">Th√¥ng tin c√° nh√¢n c·ªßa b·∫°n ƒë∆∞·ª£c b·∫£o m·∫≠t v√† ch·ªâ s·ª≠ d·ª•ng cho m·ª•c ƒë√≠ch giao d·ªãch.</p>
            </div>
          `
        },
        warranty: {
          title: 'Ch√≠nh s√°ch b·∫£o h√†nh',
          content: `
            <div class="space-y-4">
              <h3 class="font-bold text-lg" style="color: ${config.primary_action_color};">1. Th·ªùi gian b·∫£o h√†nh</h3>
              <p style="color: ${config.text_color};">M·ªói s·∫£n ph·∫©m c√≥ th·ªùi gian b·∫£o h√†nh kh√°c nhau, ƒë∆∞·ª£c ghi r√µ trong m√¥ t·∫£ s·∫£n ph·∫©m. Th√¥ng th∆∞·ªùng t·ª´ 3-12 th√°ng t√πy lo·∫°i s·∫£n ph·∫©m.</p>
              
              <h3 class="font-bold text-lg" style="color: ${config.primary_action_color};">2. ƒêi·ªÅu ki·ªán b·∫£o h√†nh</h3>
              <ul class="list-disc pl-6 space-y-2" style="color: ${config.text_color};">
                <li>Key/License b·ªã l·ªói kh√¥ng k√≠ch ho·∫°t ƒë∆∞·ª£c</li>
                <li>T√†i kho·∫£n b·ªã kh√≥a do l·ªói t·ª´ nh√† cung c·∫•p</li>
                <li>S·∫£n ph·∫©m kh√¥ng ho·∫°t ƒë·ªông nh∆∞ m√¥ t·∫£</li>
              </ul>
              
              <h3 class="font-bold text-lg" style="color: ${config.primary_action_color};">3. Kh√¥ng b·∫£o h√†nh</h3>
              <ul class="list-disc pl-6 space-y-2" style="color: ${config.text_color};">
                <li>Kh√°ch h√†ng t·ª± √Ω thay ƒë·ªïi th√¥ng tin t√†i kho·∫£n</li>
                <li>Chia sÔøΩÔøΩ key/license cho ng∆∞·ªùi kh√°c</li>
                <li>Vi ph·∫°m ƒëi·ªÅu kho·∫£n s·ª≠ d·ª•ng c·ªßa nh√† cung c·∫•p</li>
                <li>H·∫øt th·ªùi gian b·∫£o h√†nh</li>
              </ul>
              
              <h3 class="font-bold text-lg" style="color: ${config.primary_action_color};">4. H·ªó tr·ª£ 24/7</h3>
              <p style="color: ${config.text_color};">Li√™n h·ªá qua Telegram ƒë·ªÉ ƒë∆∞·ª£c h·ªó tr·ª£ nhanh nh·∫•t. Th·ªùi gian ph·∫£n h·ªìi t·ªëi ƒëa 2 gi·ªù.</p>
              
              <h3 class="font-bold text-lg" style="color: ${config.primary_action_color};">5. Quy tr√¨nh b·∫£o h√†nh</h3>
              <ol class="list-decimal pl-6 space-y-2" style="color: ${config.text_color};">
                <li>Li√™n h·ªá Telegram v·ªõi th√¥ng tin ƒë∆°n h√†ng</li>
                <li>M√¥ t·∫£ chi ti·∫øt v·∫•n ƒë·ªÅ g·∫∑p ph·∫£i</li>
                <li>Ch√∫ng t√¥i ki·ªÉm tra v√† x·ª≠ l√Ω trong 24h</li>
                <li>Thay th·∫ø key/license m·ªõi n·∫øu c·∫ßn thi·∫øt</li>
              </ol>
            </div>
          `
        }
      };
      
      const policy = policyContent[policyType];
      
      return `
        <div class="fixed inset-0 z-50 flex items-center justify-center p-4" style="background-color: rgba(0, 0, 0, 0.8);" onclick="closePolicy()">
          <div class="w-full max-w-3xl max-h-[90vh] overflow-auto rounded-2xl shadow-2xl" 
               style="background-color: ${config.surface_color}; border: 2px solid ${config.primary_action_color};"
               onclick="event.stopPropagation()">
            
            <div class="sticky top-0 z-10 p-6 border-b flex items-center justify-between" 
                 style="background-color: ${config.surface_color}; border-color: ${config.primary_action_color};">
              <h2 class="font-bold" style="color: ${config.primary_action_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 1.5}px;">
                ${policy.title}
              </h2>
              <button onclick="closePolicy()" class="p-2 hover:opacity-70 transition-opacity" style="color: ${config.text_color};">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              </button>
            </div>
            
            <div class="p-6" style="font-family: ${config.font_family}, system-ui; font-size: ${config.font_size}px;">
              ${policy.content}
            </div>
            
            <div class="p-6 border-t" style="border-color: ${config.secondary_action_color};">
              <button 
                onclick="closePolicy()"
                class="w-full py-3 rounded-xl font-semibold transition-all hover:opacity-90"
                style="background-color: ${config.primary_action_color}; color: ${config.background_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size}px;"
              >
                ƒê√≥ng
              </button>
            </div>
          </div>
        </div>
      `;
    }

    function CheckoutPage() {
      if (!isCheckoutOpen) return '';
      
      const config = window.elementSdk?.config || defaultConfig;
      const subtotal = getCartTotal();
      const discount = getDiscountAmount();
      const shipping = 0;
      const total = getFinalTotal();

      if (showOrderSuccess) {
        return `
          <div class="fixed inset-0 z-50 overflow-auto flex items-center justify-center p-4" style="background-color: ${config.background_color};">
            <div class="max-w-md w-full rounded-2xl p-8 text-center" style="background-color: ${config.surface_color}; border: 2px solid ${config.primary_action_color};">
              <div class="success-checkmark" style="background-color: ${config.primary_action_color};">
                <div class="checkmark"></div>
              </div>
              
              <h2 class="font-bold mb-4" style="color: ${config.primary_action_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 2}px;">
                ${t('orderSuccess')}
              </h2>
              
              <p class="mb-6" style="color: ${config.text_color}; opacity: 0.8; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size}px;">
                Vui l√≤ng chuy·ªÉn kho·∫£n v√† g·ª≠i bill qua Telegram ƒë·ªÉ x√°c nh·∫≠n
              </p>

              <div class="rounded-xl p-4 mb-6" style="background-color: ${config.background_color}; border: 2px solid ${config.secondary_action_color};">
                <p class="font-semibold mb-2" style="color: ${config.text_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size}px;">
                  ${t('total')}: <span style="color: ${config.primary_action_color};">${formatPrice(total)}</span>
                </p>
              </div>

              <a 
                href="${config.telegram_link || defaultConfig.telegram_link}" 
                target="_blank"
                rel="noopener noreferrer"
                class="block w-full py-4 rounded-xl font-bold mb-3 transition-all hover:opacity-90"
                style="background-color: ${config.primary_action_color}; color: ${config.background_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size}px; text-decoration: none;"
              >
                üì± G·ª≠i bill qua Telegram
              </a>

              <button 
                onclick="backToHome()"
                class="w-full py-3 rounded-xl font-semibold transition-all hover:opacity-90"
                style="background-color: ${config.secondary_action_color}; color: ${config.text_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size}px;"
              >
                ${t('backToHome')}
              </button>
            </div>
          </div>
        `;
      }

      return `
        <div class="fixed inset-0 z-50 overflow-auto" style="background-color: ${config.background_color};">
          <div class="max-w-6xl mx-auto p-4 md:p-8">
            
            <div class="mb-6">
              <button 
                onclick="backToCart()"
                class="flex items-center gap-2 mb-4 hover:opacity-70 transition-opacity"
                style="color: ${config.primary_action_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size}px;"
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
                ${t('backToCart')}
              </button>
              <h1 class="font-bold" style="color: ${config.primary_action_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 2}px;">
                ${t('checkoutTitle')}
              </h1>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
              
              <div class="lg:col-span-2 space-y-6">
                
                <div class="rounded-xl p-6 shadow-lg" style="background-color: ${config.surface_color}; border: 2px solid ${config.primary_action_color};">
                  <h2 class="font-bold mb-4" style="color: ${config.primary_action_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 1.25}px;">
                    ${t('customerInfo')}
                  </h2>
                  <form id="checkout-form" class="space-y-4" onsubmit="placeOrder(event); return false;">
                    <div>
                      <label class="block mb-2 font-semibold" style="color: ${config.text_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 0.875}px;">
                        ${t('name')} *
                      </label>
                      <input 
                        type="text" 
                        name="name"
                        required
                        class="w-full px-4 py-3 border-2 rounded-lg ${formErrors.name ? 'input-error' : ''}"
                        style="background-color: ${config.background_color}; color: ${config.text_color}; border-color: ${formErrors.name ? '#ef4444' : config.secondary_action_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size}px;"
                        placeholder="Nguy·ªÖn VƒÉn A"
                      />
                      ${formErrors.name ? `<p class="error-message">${formErrors.name}</p>` : ''}
                    </div>
                    <div>
                      <label class="block mb-2 font-semibold" style="color: ${config.text_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 0.875}px;">
                        ${t('email')} *
                      </label>
                      <input 
                        type="email" 
                        name="email"
                        required
                        class="w-full px-4 py-3 border-2 rounded-lg ${formErrors.email ? 'input-error' : ''}"
                        style="background-color: ${config.background_color}; color: ${config.text_color}; border-color: ${formErrors.email ? '#ef4444' : config.secondary_action_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size}px;"
                        placeholder="email@example.com"
                      />
                      ${formErrors.email ? `<p class="error-message">${formErrors.email}</p>` : ''}
                    </div>
                    <div>
                      <label class="block mb-2 font-semibold" style="color: ${config.text_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 0.875}px;">
                        ${t('phone')} *
                      </label>
                      <input 
                        type="tel" 
                        name="phone"
                        required
                        class="w-full px-4 py-3 border-2 rounded-lg ${formErrors.phone ? 'input-error' : ''}"
                        style="background-color: ${config.background_color}; color: ${config.text_color}; border-color: ${formErrors.phone ? '#ef4444' : config.secondary_action_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size}px;"
                        placeholder="0912345678"
                      />
                      ${formErrors.phone ? `<p class="error-message">${formErrors.phone}</p>` : ''}
                    </div>
                  </form>
                </div>

                <div class="rounded-xl p-6 shadow-lg" style="background-color: ${config.surface_color}; border: 2px solid ${config.primary_action_color};">
                  <h2 class="font-bold mb-4" style="color: ${config.primary_action_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 1.25}px;">
                    ${t('paymentMethod')}
                  </h2>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    
                    <div 
                      onclick="selectPaymentMethod('bank')"
                      class="payment-option rounded-lg p-4 border-2 cursor-pointer ${selectedPaymentMethod === 'bank' ? 'selected' : ''}"
                      style="border-color: ${selectedPaymentMethod === 'bank' ? config.primary_action_color : config.secondary_action_color}; background-color: ${config.background_color};"
                    >
                      <div class="flex items-start gap-3">
                        <div class="text-3xl">üè¶</div>
                        <div class="flex-1">
                          <h3 class="font-bold mb-1" style="color: ${config.text_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size}px;">
                            ${t('bankTransfer')}
                          </h3>
                          <p class="text-sm" style="color: ${config.text_color}; opacity: 0.7; font-family: ${config.font_family}, system-ui;">
                            ${t('bankDesc')}
                          </p>
                        </div>
                        ${selectedPaymentMethod === 'bank' ? `
                          <svg class="w-6 h-6 flex-shrink-0" style="color: ${config.primary_action_color};" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                          </svg>
                        ` : ''}
                      </div>
                    </div>

                    <div 
                      onclick="selectPaymentMethod('momo')"
                      class="payment-option rounded-lg p-4 border-2 cursor-pointer ${selectedPaymentMethod === 'momo' ? 'selected' : ''}"
                      style="border-color: ${selectedPaymentMethod === 'momo' ? config.primary_action_color : config.secondary_action_color}; background-color: ${config.background_color};"
                    >
                      <div class="flex items-start gap-3">
                        <div class="text-3xl">üí≥</div>
                        <div class="flex-1">
                          <h3 class="font-bold mb-1" style="color: ${config.text_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size}px;">
                            ${t('momo')}
                          </h3>
                          <p class="text-sm" style="color: ${config.text_color}; opacity: 0.7; font-family: ${config.font_family}, system-ui;">
                            ${t('momoDesc')}
                          </p>
                        </div>
                        ${selectedPaymentMethod === 'momo' ? `
                          <svg class="w-6 h-6 flex-shrink-0" style="color: ${config.primary_action_color};" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                          </svg>
                        ` : ''}
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Payment Note -->
                <div class="rounded-xl p-6 shadow-lg" style="background-color: #fef3c7; border: 2px solid #f59e0b;">
                  <div class="flex gap-3">
                    <div class="text-2xl">‚ö†Ô∏è</div>
                    <div>
                      <h3 class="font-bold mb-2" style="color: #d97706; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 1.125}px;">
                        L∆∞u √Ω quan tr·ªçng
                      </h3>
                      <ul class="space-y-2 text-sm" style="color: #92400e; font-family: ${config.font_family}, system-ui;">
                        <li>‚úì Sau khi ƒë·∫∑t h√†ng, vui l√≤ng chuy·ªÉn kho·∫£n theo th√¥ng tin hi·ªÉn th·ªã</li>
                        <li>‚úì <strong>Ch·ª•p bill/screenshot x√°c nh·∫≠n chuy·ªÉn kho·∫£n</strong></li>
                        <li>‚úì <strong>G·ª≠i bill qua Telegram</strong> ƒë·ªÉ ƒë∆∞·ª£c x·ª≠ l√Ω ƒë∆°n h√†ng</li>
                        <li>‚úì ƒê∆°n h√†ng ƒë∆∞·ª£c x·ª≠ l√Ω trong 5-30 ph√∫t sau khi x√°c nh·∫≠n</li>
                        <li>‚úì Key/License s·∫Ω ƒë∆∞·ª£c g·ª≠i qua Telegram</li>
                      </ul>
                    </div>
                  </div>
                </div>

                <!-- Discount Code Section -->
                <div class="rounded-xl p-6 shadow-lg" style="background-color: ${config.surface_color}; border: 2px solid ${config.primary_action_color};">
                  <h2 class="font-bold mb-4" style="color: ${config.primary_action_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 1.25}px;">
                    M√£ gi·∫£m gi√°
                  </h2>
                  ${discountApplied ? `
                    <div class="flex items-center justify-between p-4 rounded-lg" style="background-color: #dcfce7; border: 2px solid #22c55e;">
                      <div class="flex items-center gap-3">
                        <svg class="w-6 h-6" style="color: #22c55e;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <div>
                          <p class="font-bold" style="color: #22c55e; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size}px;">
                            M√£ "${discountCode}" ƒë√£ ƒë∆∞·ª£c √°p d·ª•ng
                          </p>
                          <p class="text-sm" style="color: #16a34a; font-family: ${config.font_family}, system-ui;">
                            Gi·∫£m 10% ƒë∆°n h√†ng
                          </p>
                        </div>
                      </div>
                      <button 
                        onclick="removeDiscountCode()"
                        class="px-3 py-1 rounded-lg font-semibold transition-all hover:opacity-80"
                        style="background-color: #ef4444; color: #ffffff; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 0.875}px;"
                      >
                        X√≥a
                      </button>
                    </div>
                  ` : `
                    <div class="flex gap-2">
                      <input 
                        type="text" 
                        id="discount-code-input"
                        placeholder="Nh·∫≠p m√£ gi·∫£m gi√°"
                        class="flex-1 px-4 py-3 border-2 rounded-lg"
                        style="background-color: ${config.background_color}; color: ${config.text_color}; border-color: ${config.secondary_action_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size}px;"
                      />
                      <button 
                        onclick="applyDiscountCode()"
                        class="px-6 py-3 rounded-lg font-semibold transition-all hover:opacity-90"
                        style="background-color: ${config.primary_action_color}; color: ${config.background_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size}px;"
                      >
                        √Åp d·ª•ng
                      </button>
                    </div>
                  `}
                </div>
              </div>

              <div class="lg:col-span-1">
                <div class="rounded-xl p-6 shadow-lg sticky top-4" style="background-color: ${config.surface_color}; border: 2px solid ${config.primary_action_color};">
                  <h2 class="font-bold mb-4" style="color: ${config.primary_action_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 1.25}px;">
                    ${t('orderSummary')}
                  </h2>
                  
                  <div class="space-y-3 mb-4 pb-4 border-b" style="border-color: ${config.secondary_action_color};">
                    ${cart.map(item => `
                      <div class="flex gap-3">
                        <div class="text-2xl">${item.image}</div>
                        <div class="flex-1 min-w-0">
                          <h4 class="font-semibold text-sm truncate" style="color: ${config.text_color}; font-family: ${config.font_family}, system-ui;">
                            ${item.name}
                          </h4>
                          ${item.variation ? `
                            <p class="text-xs" style="color: ${config.text_color}; opacity: 0.6; font-family: ${config.font_family}, system-ui;">
                              ${item.variation}
                            </p>
                          ` : ''}
                          <p class="text-xs mt-1" style="color: ${config.text_color}; opacity: 0.6; font-family: ${config.font_family}, system-ui;">
                            ${formatPrice(item.price)} √ó ${item.quantity}
                          </p>
                        </div>
                        <div class="font-semibold text-sm" style="color: ${config.primary_action_color}; font-family: ${config.font_family}, system-ui;">
                          ${formatPrice(item.price * item.quantity)}
                        </div>
                      </div>
                    `).join('')}
                  </div>

                  <div class="space-y-2 mb-4">
                    <div class="flex justify-between">
                      <span style="color: ${config.text_color}; opacity: 0.8; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 0.875}px;">
                        ${t('subtotal')}:
                      </span>
                      <span class="font-semibold" style="color: ${config.text_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 0.875}px;">
                        ${formatPrice(subtotal)}
                      </span>
                    </div>
                    ${discountApplied ? `
                      <div class="flex justify-between">
                        <span style="color: ${config.text_color}; opacity: 0.8; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 0.875}px;">
                          Gi·∫£m gi√° (${discountCode}):
                        </span>
                        <span class="font-bold" style="color: #22c55e; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size}px;">
                          -${formatPrice(discount)}
                        </span>
                      </div>
                    ` : ''}
                    <div class="flex justify-between">
                      <span style="color: ${config.text_color}; opacity: 0.8; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 0.875}px;">
                        ${t('shipping')}:
                      </span>
                      <span class="font-semibold" style="color: ${config.primary_action_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 0.875}px;">
                        ${t('free')}
                      </span>
                    </div>
                    <div class="border-t pt-2" style="border-color: ${config.secondary_action_color};">
                      <div class="flex justify-between items-center">
                        <span class="font-bold" style="color: ${config.text_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 1.125}px;">
                          ${t('total')}:
                        </span>
                        <span class="font-bold" style="color: ${config.primary_action_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size * 1.5}px;">
                          ${formatPrice(total)}
                        </span>
                      </div>
                    </div>
                  </div>

                  <button 
                    type="submit"
                    form="checkout-form"
                    class="w-full py-4 rounded-xl font-bold transition-all hover:opacity-90 mb-3"
                    style="background-color: ${config.primary_action_color}; color: ${config.background_color}; font-family: ${config.font_family}, system-ui; font-size: ${config.font_size}px;"
                  >
                    ${t('placeOrder')}
                  </button>
                  
                  <p class="text-center text-xs" style="color: ${config.text_color}; opacity: 0.6; font-family: ${config.font_family}, system-ui;">
                    ${t('secureCheckout')}
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function HomePage() {
      const config = window.elementSdk?.config || defaultConfig;
      const customFont = config.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      
      const filteredProducts = selectedCategory === 'all' 
        ? productsData 
        : productsData.filter(p => p.category === selectedCategory);

      const featuredProducts = productsData.filter(p => p.featured);

      return `
        <div id="snowflakes"></div>
        <div class="w-full" style="background-color: ${config.background_color}; font-family: ${customFont}, ${baseFontStack};">
          <!-- Header -->
          <header class="sticky top-0 z-40 shadow-lg" style="background-color: ${config.surface_color}; border-bottom: 2px solid ${config.primary_action_color};">
            <div class="max-w-7xl mx-auto px-4 py-4">
              <div class="flex items-center justify-between gap-4">
                <h1 class="font-bold whitespace-nowrap" style="color: ${config.primary_action_color}; font-family: ${customFont}, ${baseFontStack}; font-size: ${config.font_size * 1.5}px;">
                  ${config.site_title}
                </h1>
                
                <div class="flex-1 max-w-xl hidden md:block">
                  <input 
                    type="text" 
                    placeholder="${config.search_placeholder || t('search')}"
                    class="w-full px-4 py-2 rounded-lg border-2"
                    style="background-color: ${config.background_color}; color: ${config.text_color}; border-color: ${config.secondary_action_color}; font-family: ${customFont}, ${baseFontStack}; font-size: ${config.font_size}px;"
                  />
                </div>
                
                <div class="flex items-center gap-3">
                  <button 
                    onclick="toggleCart()"
                    class="relative p-2 hover:opacity-70 transition-opacity"
                    style="color: ${config.text_color};"
                  >
                    <svg class="w-6 h-6" style="color: ${config.primary_action_color};" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
                    </svg>
                    ${cart.length > 0 ? `
                      <span class="absolute -top-1 -right-1 w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold" 
                            style="background-color: ${config.primary_action_color}; color: #ffffff;">
                        ${cart.length}
                      </span>
                    ` : ''}
                  </button>
                </div>
              </div>
            </div>
          </header>

          <!-- Hero Section -->
          <section class="py-16 px-4 relative overflow-hidden" style="background: linear-gradient(135deg, ${config.primary_action_color}20 0%, ${config.secondary_action_color}20 100%);">
            <div class="max-w-7xl mx-auto text-center relative z-10">
              <h2 class="font-bold mb-4" style="color: ${config.primary_action_color}; font-family: ${customFont}, ${baseFontStack}; font-size: ${config.font_size * 2.5}px;">
                ${config.hero_title}
              </h2>
              <p class="mb-6" style="color: ${config.secondary_action_color}; font-family: ${customFont}, ${baseFontStack}; font-size: ${config.font_size * 1.25}px;">
                ${config.hero_subtitle}
              </p>
              <button 
                onclick="document.getElementById('products').scrollIntoView({behavior: 'smooth'})"
                class="px-8 py-3 rounded-lg font-semibold transition-all hover:opacity-90"
                style="background-color: ${config.primary_action_color}; color: ${config.background_color}; font-family: ${customFont}, ${baseFontStack}; font-size: ${config.font_size}px;"
              >
                ${t('shopNow')}
              </button>
            </div>
          </section>

          <!-- Featured Products Carousel -->
          <section class="py-12 px-4" style="background-color: ${config.surface_color};">
            <div class="max-w-7xl mx-auto">
              <h2 class="font-bold mb-8 text-center" style="color: ${config.primary_action_color}; font-family: ${customFont}, ${baseFontStack}; font-size: ${config.font_size * 2}px;">
                ${t('featuredProducts')}
              </h2>
              
              <div class="carousel-container relative" onmouseenter="stopCarousel()" onmouseleave="startCarousel()">
                <div class="carousel-track">
                  ${featuredProducts.map(product => `
                    <div class="w-full px-4 flex-shrink-0">
                      <div class="max-w-md mx-auto">
                        ${ProductCard(product, true)}
                      </div>
                    </div>
                  `).join('')}
                </div>
                
                <button 
                  onclick="prevSlide()"
                  class="absolute left-2 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full flex items-center justify-center transition-all hover:opacity-90 z-10"
                  style="background-color: ${config.primary_action_color}; color: ${config.background_color};"
                >
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                  </svg>
                </button>
                
                <button 
                  onclick="nextSlide()"
                  class="absolute right-2 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full flex items-center justify-center transition-all hover:opacity-90 z-10"
                  style="background-color: ${config.primary_action_color}; color: ${config.background_color};"
                >
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                  </svg>
                </button>
              </div>
            </div>
          </section>

          <!-- About Section -->
          <section class="py-12 px-4">
            <div class="max-w-4xl mx-auto text-center">
              <div class="rounded-2xl p-8" style="background-color: ${config.surface_color}; border: 2px solid ${config.secondary_action_color};">
                <div class="text-6xl mb-4">‚ú®</div>
                <h2 class="font-bold mb-4" style="color: ${config.primary_action_color}; font-family: ${customFont}, ${baseFontStack}; font-size: ${config.font_size * 2}px;">
                  ${config.about_title || t('aboutTitle')}
                </h2>
                <p class="mb-6" style="color: ${config.text_color}; opacity: 0.9; font-family: ${customFont}, ${baseFontStack}; font-size: ${config.font_size * 1.125}px;">
                  ${config.about_description || t('aboutDesc')}
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
                  <div class="p-6 rounded-xl" style="background-color: ${config.background_color}; border: 2px solid ${config.primary_action_color};">
                    <div class="text-4xl mb-3">üíé</div>
                    <h3 class="font-bold mb-2" style="color: ${config.primary_action_color}; font-family: ${customFont}, ${baseFontStack}; font-size: ${config.font_size * 1.125}px;">${t('authenticLicense')}</h3>
                    <p style="color: ${config.text_color}; opacity: 0.8; font-size: ${config.font_size * 0.875}px;">${t('authenticDesc')}</p>
                  </div>
                  <div class="p-6 rounded-xl" style="background-color: ${config.background_color}; border: 2px solid ${config.primary_action_color};">
                    <div class="text-4xl mb-3">üõ°Ô∏è</div>
                    <h3 class="font-bold mb-2" style="color: ${config.primary_action_color}; font-family: ${customFont}, ${baseFontStack}; font-size: ${config.font_size * 1.125}px;">${t('bestWarranty')}</h3>
                    <p style="color: ${config.text_color}; opacity: 0.8; font-size: ${config.font_size * 0.875}px;">${t('warrantyDesc')}</p>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Categories -->
          <section class="py-6 px-4 border-y" style="background-color: ${config.surface_color}; border-color: ${config.primary_action_color};">
            <div class="max-w-7xl mx-auto">
              <div class="flex flex-wrap gap-2 justify-center">
                <button 
                  onclick="filterByCategory('all')"
                  class="px-4 py-2 rounded-lg font-semibold transition-all hover:opacity-90"
                  style="background-color: ${selectedCategory === 'all' ? config.primary_action_color : config.background_color}; 
                         color: ${selectedCategory === 'all' ? config.background_color : config.text_color}; 
                         font-family: ${customFont}, ${baseFontStack}; 
                         font-size: ${config.font_size * 0.875}px;"
                >
                  ${t('allProducts')}
                </button>
                ${['maps', 'ai', 'design', 'tools'].map(cat => `
                  <button 
                    onclick="filterByCategory('${cat}')"
                    class="px-4 py-2 rounded-lg font-semibold transition-all hover:opacity-90"
                    style="background-color: ${selectedCategory === cat ? config.primary_action_color : config.background_color}; 
                           color: ${selectedCategory === cat ? config.background_color : config.text_color}; 
                           font-family: ${customFont}, ${baseFontStack}; 
                           font-size: ${config.font_size * 0.875}px;"
                  >
                    ${t('categories_nav.' + cat)}
                  </button>
                `).join('')}
              </div>
            </div>
          </section>

          <!-- Products Grid -->
          <section id="products" class="py-12 px-4">
            <div class="max-w-7xl mx-auto">
              <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                ${filteredProducts.map(product => ProductCard(product)).join('')}
              </div>
            </div>
          </section>

          <!-- Footer -->
          <footer class="py-8 px-4 border-t" style="background-color: ${config.surface_color}; border-color: ${config.primary_action_color};">
            <div class="max-w-7xl mx-auto">
              <div class="flex flex-wrap justify-center gap-6 mb-6">
                <button 
                  onclick="showPolicy('warranty')"
                  class="hover:opacity-70 transition-opacity"
                  style="color: ${config.primary_action_color}; font-family: ${customFont}, ${baseFontStack}; font-size: ${config.font_size * 0.875}px; text-decoration: underline;"
                >
                  Ch√≠nh s√°ch b·∫£o h√†nh
                </button>
                <button 
                  onclick="showPolicy('terms')"
                  class="hover:opacity-70 transition-opacity"
                  style="color: ${config.primary_action_color}; font-family: ${customFont}, ${baseFontStack}; font-size: ${config.font_size * 0.875}px; text-decoration: underline;"
                >
                  ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng
                </button>
                <a 
                  href="${config.telegram_link || defaultConfig.telegram_link}" 
                  target="_blank"
                  rel="noopener noreferrer"
                  class="hover:opacity-70 transition-opacity"
                  style="color: ${config.primary_action_color}; font-family: ${customFont}, ${baseFontStack}; font-size: ${config.font_size * 0.875}px; text-decoration: underline;"
                >
                  Li√™n h·ªá
                </a>
              </div>
              <div class="text-center pt-4 border-t" style="border-color: ${config.secondary_action_color};">
                <p style="color: ${config.text_color}; opacity: 0.6; font-family: ${customFont}, ${baseFontStack}; font-size: ${config.font_size * 0.875}px;">
                  ¬© 2024 ${config.site_title}. All rights reserved.
                </p>
              </div>
            </div>
          </footer>

          <!-- Chat Support Button -->
          <a
            href="${config.telegram_link || defaultConfig.telegram_link}" 
            target="_blank"
            rel="noopener noreferrer"
            class="chat-button fixed bottom-6 right-6 w-16 h-16 rounded-full shadow-lg flex items-center justify-center z-30 transition-all"
            style="background-color: ${config.primary_action_color}; color: ${config.background_color};"
          >
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
            </svg>
          </a>
        </div>
      `;
    }

    function render() {
      const app = document.getElementById('app');
      
      if (isCheckoutOpen) {
        app.innerHTML = CheckoutPage() + PolicyModal();
        createSnowflakes();
        return;
      }

      app.innerHTML = HomePage() + CartDrawer() + PolicyModal();
      
      if (currentPage === 'home') {
        startCarousel();
      }
      
      createSnowflakes();
    }

    // Global functions
    window.handleAddToCart = function(productId) {
      const product = productsData.find(p => p.id === productId);
      if (!product) return;

      if (product.hasVariations) {
        const selects = document.querySelectorAll(`select[data-product-id="${productId}"]`);
        let variationId = null;
        
        for (const select of selects) {
          if (select.value) {
            variationId = select.value;
            break;
          }
        }
        
        if (!variationId) {
          showToast(currentLanguage === 'vi' ? 'Vui l√≤ng ch·ªçn t√πy ch·ªçn' : 'Please select an option');
          return;
        }
        
        const variation = product.variations.find(v => v.id === variationId);
        addToCart(product, variation);
        
        // Reset all selects for this product
        selects.forEach(select => select.value = '');
      } else {
        addToCart(product);
      }
    };

    window.toggleCart = toggleCart;
    window.toggleLanguage = toggleLanguage;
    window.filterByCategory = filterByCategory;
    window.removeFromCart = removeFromCart;
    window.updateQuantity = updateQuantity;
    window.proceedToCheckout = proceedToCheckout;
    window.backToCart = backToCart;
    window.backToHome = backToHome;
    window.selectPaymentMethod = selectPaymentMethod;
    window.placeOrder = placeOrder;
    window.navigateTo = navigateTo;
    window.nextSlide = nextSlide;
    window.prevSlide = prevSlide;
    window.startCarousel = startCarousel;
    window.stopCarousel = stopCarousel;
    window.applyDiscountCode = applyDiscountCode;
    window.removeDiscountCode = removeDiscountCode;
    window.showPolicy = showPolicy;
    window.closePolicy = closePolicy;

    async function onConfigChange(config) {
      render();
    }

    const capabilities = {
      recolorables: [
        {
          get: () => (window.elementSdk?.config || defaultConfig).background_color,
          set: (value) => {
            if (window.elementSdk) {
              window.elementSdk.setConfig({ background_color: value });
            }
          }
        },
        {
          get: () => (window.elementSdk?.config || defaultConfig).surface_color,
          set: (value) => {
            if (window.elementSdk) {
              window.elementSdk.setConfig({ surface_color: value });
            }
          }
        },
        {
          get: () => (window.elementSdk?.config || defaultConfig).text_color,
          set: (value) => {
            if (window.elementSdk) {
              window.elementSdk.setConfig({ text_color: value });
            }
          }
        },
        {
          get: () => (window.elementSdk?.config || defaultConfig).primary_action_color,
          set: (value) => {
            if (window.elementSdk) {
              window.elementSdk.setConfig({ primary_action_color: value });
            }
          }
        },
        {
          get: () => (window.elementSdk?.config || defaultConfig).secondary_action_color,
          set: (value) => {
            if (window.elementSdk) {
              window.elementSdk.setConfig({ secondary_action_color: value });
            }
          }
        }
      ],
      borderables: [],
      fontEditable: {
        get: () => (window.elementSdk?.config || defaultConfig).font_family,
        set: (value) => {
          if (window.elementSdk) {
            window.elementSdk.setConfig({ font_family: value });
          }
        }
      },
      fontSizeable: {
        get: () => (window.elementSdk?.config || defaultConfig).font_size,
        set: (value) => {
          if (window.elementSdk) {
            window.elementSdk.setConfig({ font_size: value });
          }
        }
      }
    };

    function mapToCapabilities(config) {
      return capabilities;
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ['site_title', config.site_title || defaultConfig.site_title],
        ['hero_title', config.hero_title || defaultConfig.hero_title],
        ['hero_subtitle', config.hero_subtitle || defaultConfig.hero_subtitle],
        ['about_title', config.about_title || defaultConfig.about_title],
        ['about_description', config.about_description || defaultConfig.about_description],
        ['search_placeholder', config.search_placeholder || defaultConfig.search_placeholder],
        ['add_to_cart_text', config.add_to_cart_text || defaultConfig.add_to_cart_text],
        ['checkout_button', config.checkout_button || defaultConfig.checkout_button],
        ['telegram_link', config.telegram_link || defaultConfig.telegram_link]
      ]);
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    }

    render();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b41462873a40725',t:'MTc2Njc1OTQwNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>